{"version":3,"sources":["browser.js"],"names":[],"mappings":"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","file":"browser-compiled.js","sourcesContent":["// Load modules\r\n\r\nvar Url = require('url');\r\nvar Code = require('code');\r\nvar Hawk = require('../lib');\r\nvar Hoek = require('hoek');\r\nvar Lab = require('lab');\r\nvar Browser = require('../lib/browser');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\n// Test shortcuts\r\n\r\nvar lab = exports.lab = Lab.script();\r\nvar describe = lab.experiment;\r\nvar it = lab.test;\r\nvar expect = Code.expect;\r\n\r\n\r\ndescribe('Browser', function () {\r\n\r\n    var credentialsFunc = function (id, callback) {\r\n\r\n        var credentials = {\r\n            id: id,\r\n            key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n            algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n            user: 'steve'\r\n        };\r\n\r\n        return callback(null, credentials);\r\n    };\r\n\r\n    it('should generate a bewit then successfully authenticate it', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?a=1&b=2',\r\n            host: 'example.com',\r\n            port: 80\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var bewit = Browser.client.bewit('http://example.com/resource/4?a=1&b=2', { credentials: credentials1, ttlSec: 60 * 60 * 24 * 365 * 100, ext: 'some-app-data' });\r\n            req.url += '&bewit=' + bewit;\r\n\r\n            Hawk.uri.authenticate(req, credentialsFunc, {}, function (err, credentials2, attributes) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(attributes.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('should generate a bewit then successfully authenticate it (no ext)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?a=1&b=2',\r\n            host: 'example.com',\r\n            port: 80\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var bewit = Browser.client.bewit('http://example.com/resource/4?a=1&b=2', { credentials: credentials1, ttlSec: 60 * 60 * 24 * 365 * 100 });\r\n            req.url += '&bewit=' + bewit;\r\n\r\n            Hawk.uri.authenticate(req, credentialsFunc, {}, function (err, credentials2, attributes) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('bewit()', function () {\r\n\r\n        it('returns a valid bewit value', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('MTIzNDU2XDEzNTY0MjA3MDdca3NjeHdOUjJ0SnBQMVQxekRMTlBiQjVVaUtJVTl0T1NKWFRVZEc3WDloOD1ceGFuZHlhbmR6');\r\n            done();\r\n        });\r\n\r\n        it('returns a valid bewit value (explicit HTTP port)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('http://example.com:8080/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('MTIzNDU2XDEzNTY0MjA3MDdcaFpiSjNQMmNLRW80a3kwQzhqa1pBa1J5Q1p1ZWc0V1NOYnhWN3ZxM3hIVT1ceGFuZHlhbmR6');\r\n            done();\r\n        });\r\n\r\n        it('returns a valid bewit value (explicit HTTPS port)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com:8043/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('MTIzNDU2XDEzNTY0MjA3MDdcL2t4UjhwK0xSaTdvQTRnUXc3cWlxa3BiVHRKYkR4OEtRMC9HRUwvVytTUT1ceGFuZHlhbmR6');\r\n            done();\r\n        });\r\n\r\n        it('returns a valid bewit value (null ext)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: null });\r\n            expect(bewit).to.equal('MTIzNDU2XDEzNTY0MjA3MDdcSUdZbUxnSXFMckNlOEN4dktQczRKbFdJQStValdKSm91d2dBUmlWaENBZz1c');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid options', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', 4);\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing uri', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('', { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid uri', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit(5, { credentials: credentials, ttlSec: 300, localtimeOffsetMsec: 1356420407232 - Hawk.utils.now(), ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid credentials (id)', function (done) {\r\n\r\n            var credentials = {\r\n                key: '2983d45yun89q',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 3000, ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing credentials', function (done) {\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { ttlSec: 3000, ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid credentials (key)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                algorithm: 'sha256'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 3000, ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid algorithm', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'hmac-sha-0'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow', { credentials: credentials, ttlSec: 300, ext: 'xandyandz' });\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing options', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: '2983d45yun89q',\r\n                algorithm: 'hmac-sha-0'\r\n            };\r\n\r\n            var bewit = Browser.client.bewit('https://example.com/somewhere/over/the/rainbow');\r\n            expect(bewit).to.equal('');\r\n            done();\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (configuration)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' }).field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (node request)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (browserify)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (time offset)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', localtimeOffsetMsec: 100000 }).field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 100000 }, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (no server header options)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts);\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (no server header)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header with stale ts and successfully authenticate on second call', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            Browser.utils.setNtpOffset(60 * 60 * 1000);\r\n            var header = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' });\r\n            req.authorization = header.field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts2) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Stale timestamp');\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': err.output.headers['WWW-Authenticate']\r\n                    },\r\n                    getResponseHeader: function (lookup) {\r\n\r\n                        return res.headers[lookup.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.utils.getNtpOffset()).to.equal(60 * 60 * 1000);\r\n                expect(Browser.client.authenticate(res, credentials2, header.artifacts)).to.equal(true);\r\n                expect(Browser.utils.getNtpOffset()).to.equal(0);\r\n\r\n                req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials2, ext: 'some-app-data' }).field;\r\n                expect(req.authorization).to.exist();\r\n\r\n                Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials3, artifacts3) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    expect(credentials3.user).to.equal('steve');\r\n                    expect(artifacts3.ext).to.equal('some-app-data');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header with stale ts and successfully authenticate on second call (manual localStorage)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var localStorage = new Browser.internals.LocalStorage();\r\n\r\n            Browser.utils.setStorage(localStorage);\r\n\r\n            Browser.utils.setNtpOffset(60 * 60 * 1000);\r\n            var header = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' });\r\n            req.authorization = header.field;\r\n            expect(req.authorization).to.exist();\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts2) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Stale timestamp');\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': err.output.headers['WWW-Authenticate']\r\n                    },\r\n                    getResponseHeader: function (lookup) {\r\n\r\n                        return res.headers[lookup.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(parseInt(localStorage.getItem('hawk_ntp_offset'))).to.equal(60 * 60 * 1000);\r\n                expect(Browser.utils.getNtpOffset()).to.equal(60 * 60 * 1000);\r\n                expect(Browser.client.authenticate(res, credentials2, header.artifacts)).to.equal(true);\r\n                expect(Browser.utils.getNtpOffset()).to.equal(0);\r\n                expect(parseInt(localStorage.getItem('hawk_ntp_offset'))).to.equal(0);\r\n\r\n                req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials2, ext: 'some-app-data' }).field;\r\n                expect(req.authorization).to.exist();\r\n\r\n                Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials3, artifacts3) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    expect(credentials3.user).to.equal('steve');\r\n                    expect(artifacts3.ext).to.equal('some-app-data');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then fails to parse it (missing server header hash)', function (done) {\r\n\r\n        var req = {\r\n            method: 'POST',\r\n            url: '/resource/4?filter=a',\r\n            headers: {\r\n                host: 'example.com:8080',\r\n                'content-type': 'text/plain;x=y'\r\n            }\r\n        };\r\n\r\n        var payload = 'some not so random text';\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            var reqHeader = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', payload: payload, contentType: req.headers['content-type'] });\r\n            req.headers.authorization = reqHeader.field;\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers['content-type'])).to.equal(true);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                res.headers['server-authorization'] = Hawk.server.header(credentials2, artifacts);\r\n                expect(res.headers['server-authorization']).to.exist();\r\n\r\n                expect(Browser.client.authenticate(res, credentials2, artifacts, { payload: 'some reply' })).to.equal(false);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (with hash)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it then validate payload', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(Hawk.server.authenticatePayload('hola!', credentials2, artifacts)).to.be.true();\r\n                expect(Hawk.server.authenticatePayload('hello!', credentials2, artifacts)).to.be.false();\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (app)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', app: 'asd23ased' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(artifacts.app).to.equal('asd23ased');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then successfully parse it (app, dlg)', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data', app: 'asd23ased', dlg: '23434szr3q4d' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials2.user).to.equal('steve');\r\n                expect(artifacts.ext).to.equal('some-app-data');\r\n                expect(artifacts.app).to.equal('asd23ased');\r\n                expect(artifacts.dlg).to.equal('23434szr3q4d');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header then fail authentication due to bad hash', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, payload: 'hola!', ext: 'some-app-data' }).field;\r\n            Hawk.server.authenticate(req, credentialsFunc, { payload: 'byebye!' }, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad payload hash');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    it('generates a header for one resource then fail to authenticate another', function (done) {\r\n\r\n        var req = {\r\n            method: 'GET',\r\n            url: '/resource/4?filter=a',\r\n            host: 'example.com',\r\n            port: 8080\r\n        };\r\n\r\n        credentialsFunc('123456', function (err, credentials1) {\r\n\r\n            req.authorization = Browser.client.header('http://example.com:8080/resource/4?filter=a', req.method, { credentials: credentials1, ext: 'some-app-data' }).field;\r\n            req.url = '/something/else';\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials2, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(credentials2).to.exist();\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('client', function () {\r\n\r\n        describe('header()', function () {\r\n\r\n            it('returns a valid authorization header (sha1)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha1'\r\n                };\r\n\r\n                var header = Browser.client.header('http://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about' }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"bsvY3IfUllw6V5rvk4tStEvpBhE=\", ext=\"Bazinga!\", mac=\"qbf1ZPG/r/e06F4ht+T77LXi5vw=\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (sha256)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", ext=\"Bazinga!\", mac=\"q1CwFoSHzPZSkbIvl0oYlD+91rBUEvFk763nMjMndj8=\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (empty payload)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha1'\r\n                };\r\n\r\n                var header = Browser.client.header('http://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207, nonce: 'Ygvqdz', payload: '' }).field;\r\n                expect(header).to.equal('Hawk id=\\\"123456\\\", ts=\\\"1353809207\\\", nonce=\\\"Ygvqdz\\\", hash=\\\"404ghL7K+hfyhByKKejFBRGgTjU=\\\", ext=\\\"Bazinga!\\\", mac=\\\"Bh1sj1DOfFRWOdi3ww52nLCJdBE=\\\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (no ext)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", mac=\"HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs=\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (null ext)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain', ext: null }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", mac=\"HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs=\"');\r\n                done();\r\n            });\r\n\r\n            it('returns a valid authorization header (uri object)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var uri = Browser.utils.parseUri('https://example.net/somewhere/over/the/rainbow');\r\n                var header = Browser.client.header(uri, 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' }).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", mac=\"HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs=\"');\r\n                done();\r\n            });\r\n\r\n            it('errors on missing options', function (done) {\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST');\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on empty uri', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('', 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid uri', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header(4, 'POST', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on missing method', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', '', { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid method', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 5, { credentials: credentials, timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid argument type');\r\n                done();\r\n            });\r\n\r\n            it('errors on missing credentials', function (done) {\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { ext: 'Bazinga!', timestamp: 1353809207 });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid credentials object');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid credentials (id)', function (done) {\r\n\r\n                var credentials = {\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207 });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid credentials object');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid credentials (key)', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207 });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Invalid credentials object');\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid algorithm', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'hmac-sha-0'\r\n                };\r\n\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', { credentials: credentials, payload: 'something, anything!', ext: 'Bazinga!', timestamp: 1353809207 });\r\n                expect(header.field).to.equal('');\r\n                expect(header.err).to.equal('Unknown algorithm');\r\n                done();\r\n            });\r\n\r\n            it('uses a pre-calculated payload hash', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: '2983d45yun89q',\r\n                    algorithm: 'sha256'\r\n                };\r\n\r\n                var options = { credentials: credentials, ext: 'Bazinga!', timestamp: 1353809207, nonce: 'Ygvqdz', payload: 'something to write about', contentType: 'text/plain' };\r\n                options.hash = Browser.crypto.calculatePayloadHash(options.payload, credentials.algorithm, options.contentType);\r\n                var header = Browser.client.header('https://example.net/somewhere/over/the/rainbow', 'POST', options).field;\r\n                expect(header).to.equal('Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=\", ext=\"Bazinga!\", mac=\"q1CwFoSHzPZSkbIvl0oYlD+91rBUEvFk763nMjMndj8=\"');\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('authenticate()', function () {\r\n\r\n            it('skips tsm validation when missing ts', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': 'Hawk error=\"Stale timestamp\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                var artifacts = {\r\n                    ts: 1402135580,\r\n                    nonce: 'iBRB6t',\r\n                    method: 'GET',\r\n                    resource: '/resource/4?filter=a',\r\n                    host: 'example.com',\r\n                    port: '8080',\r\n                    ext: 'some-app-data'\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n\r\n            it('returns false on invalid header', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'server-authorization': 'Hawk mac=\"abc\", bad=\"xyz\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, {})).to.equal(false);\r\n                done();\r\n            });\r\n\r\n            it('returns false on invalid mac', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain',\r\n                        'server-authorization': 'Hawk mac=\"_IJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE=\", hash=\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\", ext=\"response-specific\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                var artifacts = {\r\n                    method: 'POST',\r\n                    host: 'example.com',\r\n                    port: '8080',\r\n                    resource: '/resource/4?filter=a',\r\n                    ts: '1362336900',\r\n                    nonce: 'eb5S_L',\r\n                    hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                    ext: 'some-app-data',\r\n                    app: undefined,\r\n                    dlg: undefined,\r\n                    mac: 'BlmSe8K+pbKIb6YsZCnt4E1GrYvY1AaYayNR82dGpIk=',\r\n                    id: '123456'\r\n                };\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials, artifacts)).to.equal(false);\r\n                done();\r\n            });\r\n\r\n            it('returns true on ignoring hash', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'content-type': 'text/plain',\r\n                        'server-authorization': 'Hawk mac=\"XIJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE=\", hash=\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\", ext=\"response-specific\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                var artifacts = {\r\n                    method: 'POST',\r\n                    host: 'example.com',\r\n                    port: '8080',\r\n                    resource: '/resource/4?filter=a',\r\n                    ts: '1362336900',\r\n                    nonce: 'eb5S_L',\r\n                    hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                    ext: 'some-app-data',\r\n                    app: undefined,\r\n                    dlg: undefined,\r\n                    mac: 'BlmSe8K+pbKIb6YsZCnt4E1GrYvY1AaYayNR82dGpIk=',\r\n                    id: '123456'\r\n                };\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid WWW-Authenticate header format', function (done) {\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': 'Hawk ts=\"1362346425875\", tsm=\"PhwayS28vtnn3qbv0mqRBYSXebN/zggEtucfeZ620Zo=\", x=\"Stale timestamp\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, {})).to.equal(false);\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid WWW-Authenticate header format', function (done) {\r\n\r\n                var credentials = {\r\n                    id: '123456',\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': 'Hawk ts=\"1362346425875\", tsm=\"hwayS28vtnn3qbv0mqRBYSXebN/zggEtucfeZ620Zo=\", error=\"Stale timestamp\"'\r\n                    },\r\n                    getResponseHeader: function (header) {\r\n\r\n                        return res.headers[header.toLowerCase()];\r\n                    }\r\n                };\r\n\r\n                expect(Browser.client.authenticate(res, credentials)).to.equal(false);\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('message()', function () {\r\n\r\n            it('generates an authorization then successfully parse it', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                    expect(auth).to.exist();\r\n\r\n                    Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                        expect(err).to.not.exist();\r\n                        expect(credentials2.user).to.equal('steve');\r\n                        done();\r\n                    });\r\n                });\r\n            });\r\n\r\n            it('generates an authorization using custom nonce/timestamp', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: credentials, nonce: 'abc123', timestamp: 1398536270957 });\r\n                    expect(auth).to.exist();\r\n                    expect(auth.nonce).to.equal('abc123');\r\n                    expect(auth.ts).to.equal(1398536270957);\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on missing host', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message(null, 8080, 'some message', { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid host', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message(5, 8080, 'some message', { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on missing port', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 0, 'some message', { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid port', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 'a', 'some message', { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on missing message', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, undefined, { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on null message', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, null, { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid message', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var auth = Browser.client.message('example.com', 8080, 5, { credentials: credentials });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on missing credentials', function (done) {\r\n\r\n                var auth = Browser.client.message('example.com', 8080, 'some message', {});\r\n                expect(auth).to.not.exist();\r\n                done();\r\n            });\r\n\r\n            it('errors on missing options', function (done) {\r\n\r\n                var auth = Browser.client.message('example.com', 8080, 'some message');\r\n                expect(auth).to.not.exist();\r\n                done();\r\n            });\r\n\r\n            it('errors on invalid credentials (id)', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var creds = Hoek.clone(credentials);\r\n                    delete creds.id;\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: creds });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid credentials (key)', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var creds = Hoek.clone(credentials);\r\n                    delete creds.key;\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: creds });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('errors on invalid algorithm', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var creds = Hoek.clone(credentials);\r\n                    creds.algorithm = 'blah';\r\n                    var auth = Browser.client.message('example.com', 8080, 'some message', { credentials: creds });\r\n                    expect(auth).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        describe('authenticateTimestamp()', function (done) {\r\n\r\n            it('validates a timestamp', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var tsm = Hawk.crypto.timestampMessage(credentials);\r\n                    expect(Browser.client.authenticateTimestamp(tsm, credentials)).to.equal(true);\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('validates a timestamp without updating local time', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var offset = Browser.utils.getNtpOffset();\r\n                    var tsm = Hawk.crypto.timestampMessage(credentials, 10000);\r\n                    expect(Browser.client.authenticateTimestamp(tsm, credentials, false)).to.equal(true);\r\n                    expect(offset).to.equal(Browser.utils.getNtpOffset());\r\n                    done();\r\n                });\r\n            });\r\n\r\n            it('detects a bad timestamp', function (done) {\r\n\r\n                credentialsFunc('123456', function (err, credentials) {\r\n\r\n                    var tsm = Hawk.crypto.timestampMessage(credentials);\r\n                    tsm.ts = 4;\r\n                    expect(Browser.client.authenticateTimestamp(tsm, credentials)).to.equal(false);\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('internals', function () {\r\n\r\n        describe('LocalStorage', function () {\r\n\r\n            it('goes through the full lifecycle', function (done) {\r\n\r\n                var storage = new Browser.internals.LocalStorage();\r\n                expect(storage.length).to.equal(0);\r\n                expect(storage.getItem('a')).to.equal(null);\r\n                storage.setItem('a', 5);\r\n                expect(storage.length).to.equal(1);\r\n                expect(storage.key()).to.equal('a');\r\n                expect(storage.key(0)).to.equal('a');\r\n                expect(storage.getItem('a')).to.equal('5');\r\n                storage.setItem('b', 'test');\r\n                expect(storage.key()).to.equal('a');\r\n                expect(storage.key(0)).to.equal('a');\r\n                expect(storage.key(1)).to.equal('b');\r\n                expect(storage.length).to.equal(2);\r\n                expect(storage.getItem('b')).to.equal('test');\r\n                storage.removeItem('a');\r\n                expect(storage.length).to.equal(1);\r\n                expect(storage.getItem('a')).to.equal(null);\r\n                expect(storage.getItem('b')).to.equal('test');\r\n                storage.clear();\r\n                expect(storage.length).to.equal(0);\r\n                expect(storage.getItem('a')).to.equal(null);\r\n                expect(storage.getItem('b')).to.equal(null);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('utils', function () {\r\n\r\n        describe('setStorage()', function () {\r\n\r\n            it('sets storage for the first time', function (done) {\r\n\r\n                Browser.utils.storage = new Browser.internals.LocalStorage();        // Reset state\r\n\r\n                expect(Browser.utils.storage.getItem('hawk_ntp_offset')).to.not.exist();\r\n                Browser.utils.storage.setItem('test', '1');\r\n                Browser.utils.setStorage(new Browser.internals.LocalStorage());\r\n                expect(Browser.utils.storage.getItem('test')).to.not.exist();\r\n                Browser.utils.storage.setItem('test', '2');\r\n                expect(Browser.utils.storage.getItem('test')).to.equal('2');\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('setNtpOffset()', function (done) {\r\n\r\n            it('catches localStorage errors', { parallel: false }, function (done) {\r\n\r\n                var orig = Browser.utils.storage.setItem;\r\n                var consoleOrig = console.error;\r\n                var count = 0;\r\n                console.error = function () {\r\n\r\n                    if (count++ === 2) {\r\n\r\n                        console.error = consoleOrig;\r\n                    }\r\n                };\r\n\r\n                Browser.utils.storage.setItem = function () {\r\n\r\n                    Browser.utils.storage.setItem = orig;\r\n                    throw new Error();\r\n                };\r\n\r\n                expect(function () {\r\n\r\n                    Browser.utils.setNtpOffset(100);\r\n                }).not.to.throw();\r\n\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('parseAuthorizationHeader()', function (done) {\r\n\r\n            it('returns null on missing header', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader()).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on bad header syntax (structure)', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader('Hawk')).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on bad header syntax (parts)', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader(' ')).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on bad scheme name', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader('Basic asdasd')).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on bad attribute value', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader('Hawk test=\"\\t\"', ['test'])).to.equal(null);\r\n                done();\r\n            });\r\n\r\n            it('returns null on duplicated attribute', function (done) {\r\n\r\n                expect(Browser.utils.parseAuthorizationHeader('Hawk test=\"a\", test=\"b\"', ['test'])).to.equal(null);\r\n                done();\r\n            });\r\n        });\r\n\r\n        describe('parseUri()', function () {\r\n\r\n            it('returns empty object on invalid', function (done) {\r\n\r\n                var uri = Browser.utils.parseUri('ftp');\r\n                expect(uri).to.deep.equal({ host: '', port: '', resource: '' });\r\n                done();\r\n            });\r\n\r\n            it('returns empty port when unknown scheme', function (done) {\r\n\r\n                var uri = Browser.utils.parseUri('ftp://example.com');\r\n                expect(uri.port).to.equal('');\r\n                done();\r\n            });\r\n\r\n            it('returns default port when missing', function (done) {\r\n\r\n                var uri = Browser.utils.parseUri('http://example.com');\r\n                expect(uri.port).to.equal('80');\r\n                done();\r\n            });\r\n\r\n            it('handles unusual characters correctly', function (done) {\r\n\r\n                var parts = {\r\n                    protocol: 'http+vnd.my-extension',\r\n                    user: 'user!$&\\'()*+,;=%40my-domain.com',\r\n                    password: 'pass!$&\\'()*+,;=%40:word',\r\n                    hostname: 'foo-bar.com',\r\n                    port: '99',\r\n                    pathname: '/path/%40/!$&\\'()*+,;=:@/',\r\n                    query: 'query%40/!$&\\'()*+,;=:@/?',\r\n                    fragment: 'fragm%40/!$&\\'()*+,;=:@/?'\r\n                };\r\n\r\n                parts.userInfo = parts.user + ':' + parts.password;\r\n                parts.authority = parts.userInfo + '@' + parts.hostname + ':' + parts.port;\r\n                parts.relative = parts.pathname + '?' + parts.query;\r\n                parts.resource = parts.relative + '#' + parts.fragment;\r\n                parts.source = parts.protocol + '://' + parts.authority + parts.resource;\r\n\r\n                var uri = Browser.utils.parseUri(parts.source);\r\n                expect(uri.host).to.equal('foo-bar.com');\r\n                expect(uri.port).to.equal('99');\r\n                expect(uri.resource).to.equal(parts.pathname + '?' + parts.query);\r\n                done();\r\n            });\r\n        });\r\n\r\n        var str = 'https://www.google.ca/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=url';\r\n        var base64str = 'aHR0cHM6Ly93d3cuZ29vZ2xlLmNhL3dlYmhwP3NvdXJjZWlkPWNocm9tZS1pbnN0YW50Jmlvbj0xJmVzcHY9MiZpZT1VVEYtOCNxPXVybA';\r\n\r\n        describe('base64urlEncode()', function () {\r\n\r\n            it('should base64 URL-safe decode a string', function (done) {\r\n\r\n                expect(Browser.utils.base64urlEncode(str)).to.equal(base64str);\r\n                done();\r\n            });\r\n        });\r\n    });\r\n});\r\n"]}