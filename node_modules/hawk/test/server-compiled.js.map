{"version":3,"sources":["server.js"],"names":[],"mappings":"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","file":"server-compiled.js","sourcesContent":["// Load modules\r\n\r\nvar Url = require('url');\r\nvar Code = require('code');\r\nvar Hawk = require('../lib');\r\nvar Hoek = require('hoek');\r\nvar Lab = require('lab');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\n// Test shortcuts\r\n\r\nvar lab = exports.lab = Lab.script();\r\nvar describe = lab.experiment;\r\nvar it = lab.test;\r\nvar expect = Code.expect;\r\n\r\n\r\ndescribe('Server', function () {\r\n\r\n    var credentialsFunc = function (id, callback) {\r\n\r\n        var credentials = {\r\n            id: id,\r\n            key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n            algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n            user: 'steve'\r\n        };\r\n\r\n        return callback(null, credentials);\r\n    };\r\n\r\n    describe('authenticate()', function () {\r\n\r\n        it('parses a valid authentication header (sha1)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"1\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"zy79QQ5/EYFmQqutVnYb73gAc/U=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('parses a valid authentication header (sha256)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/1?b=1&a=2',\r\n                host: 'example.com',\r\n                port: 8000,\r\n                authorization: 'Hawk id=\"dh37fgj492je\", ts=\"1353832234\", nonce=\"j4h3g2\", mac=\"m8r1rHbXN6NgO+KIIhjO7sFRyd78RNGVUwehe8Cp2dU=\", ext=\"some-app-data\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353832234000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('parses a valid authentication header (host override)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: 'example1.com:8080',\r\n                    authorization: 'Hawk id=\"1\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"zy79QQ5/EYFmQqutVnYb73gAc/U=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { host: 'example.com', localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('parses a valid authentication header (host port override)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: 'example1.com:80',\r\n                    authorization: 'Hawk id=\"1\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"zy79QQ5/EYFmQqutVnYb73gAc/U=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { host: 'example.com', port: 8080, localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('parses a valid authentication header (POST with payload)', function (done) {\r\n\r\n            var req = {\r\n                method: 'POST',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123456\", ts=\"1357926341\", nonce=\"1AwuJD\", hash=\"qAiXIVv+yjDATneWxZP2YCTa9aHRgQdnH9b3Wc+o3dg=\", ext=\"some-app-data\", mac=\"UeYcj5UoTVaAWXNvJfLVia7kU3VabxCqrccXP8sUGC4=\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1357926341000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials.user).to.equal('steve');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on missing hash', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/1?b=1&a=2',\r\n                host: 'example.com',\r\n                port: 8000,\r\n                authorization: 'Hawk id=\"dh37fgj492je\", ts=\"1353832234\", nonce=\"j4h3g2\", mac=\"m8r1rHbXN6NgO+KIIhjO7sFRyd78RNGVUwehe8Cp2dU=\", ext=\"some-app-data\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { payload: 'body', localtimeOffsetMsec: 1353832234000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing required payload hash');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on a stale timestamp', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123456\", ts=\"1362337299\", nonce=\"UzmxSs\", ext=\"some-app-data\", mac=\"wnNUxchvvryMH2RxckTdZ/gY3ijzvccx4keVvELC61w=\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Stale timestamp');\r\n                var header = err.output.headers['WWW-Authenticate'];\r\n                var ts = header.match(/^Hawk ts\\=\\\"(\\d+)\\\"\\, tsm\\=\\\"([^\\\"]+)\\\"\\, error=\\\"Stale timestamp\\\"$/);\r\n                var now = Hawk.utils.now();\r\n                expect(parseInt(ts[1], 10) * 1000).to.be.within(now - 1000, now + 1000);\r\n\r\n                var res = {\r\n                    headers: {\r\n                        'www-authenticate': header\r\n                    }\r\n                };\r\n\r\n                expect(Hawk.client.authenticate(res, credentials, artifacts)).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on a replay', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"bXx7a7p1h9QYQNZ8x7QhvDQym8ACgab4m3lVSFn4DBw=\", ext=\"hello\"'\r\n            };\r\n\r\n            var memoryCache = {};\r\n            var options = {\r\n                localtimeOffsetMsec: 1353788437000 - Hawk.utils.now(),\r\n                nonceFunc: function (key, nonce, ts, callback) {\r\n\r\n                    if (memoryCache[key + nonce]) {\r\n                        return callback(new Error());\r\n                    }\r\n\r\n                    memoryCache[key + nonce] = true;\r\n                    return callback();\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, options, function (err, credentials1, artifacts1) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials1.user).to.equal('steve');\r\n\r\n                Hawk.server.authenticate(req, credentialsFunc, options, function (err, credentials2, artifacts2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.output.payload.message).to.equal('Invalid nonce');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('does not error on nonce collision if keys differ', function (done) {\r\n\r\n            var reqSteve = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"bXx7a7p1h9QYQNZ8x7QhvDQym8ACgab4m3lVSFn4DBw=\", ext=\"hello\"'\r\n            };\r\n\r\n            var reqBob = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"456\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"LXfmTnRzrLd9TD7yfH+4se46Bx6AHyhpM94hLCiNia4=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    '123': {\r\n                        id: id,\r\n                        key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                        algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n                        user: 'steve'\r\n                    },\r\n                    '456': {\r\n                        id: id,\r\n                        key: 'xrunpaw3489ruxnpa98w4rxnwerxhqb98rpaxn39848',\r\n                        algorithm: (id === '1' ? 'sha1' : 'sha256'),\r\n                        user: 'bob'\r\n                    }\r\n                };\r\n\r\n                return callback(null, credentials[id]);\r\n            };\r\n\r\n            var memoryCache = {};\r\n            var options = {\r\n                localtimeOffsetMsec: 1353788437000 - Hawk.utils.now(),\r\n                nonceFunc: function (key, nonce, ts, callback) {\r\n\r\n                    if (memoryCache[key + nonce]) {\r\n                        return callback(new Error());\r\n                    }\r\n\r\n                    memoryCache[key + nonce] = true;\r\n                    return callback();\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(reqSteve, credentialsFuncion, options, function (err, credentials1, artifacts1) {\r\n\r\n                expect(err).to.not.exist();\r\n                expect(credentials1.user).to.equal('steve');\r\n\r\n                Hawk.server.authenticate(reqBob, credentialsFuncion, options, function (err, credentials2, artifacts2) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    expect(credentials2.user).to.equal('bob');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors on an invalid authentication header: wrong scheme', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Basic asdasdasdasd'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.not.exist();\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an invalid authentication header: no scheme', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: '!@#'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid header syntax');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization header', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, {}, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.isMissing).to.equal(true);\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing host header', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid Host header');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization attribute (id)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing attributes');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization attribute (ts)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing attributes');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization attribute (nonce)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing attributes');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an missing authorization attribute (mac)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Missing attributes');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an unknown authorization attribute', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", x=\"3\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Unknown attribute: x');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an bad authorization header format', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\\\\\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad header format');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an bad authorization attribute value', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"\\t\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad attribute value: id');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an empty authorization attribute value', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad attribute value: id');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on duplicated authorization attribute key', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", id=\"456\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Duplicate attribute: id');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an invalid authorization header format', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk'\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid header syntax');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an bad host header (missing host)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: ':8080',\r\n                    authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid Host header');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on an bad host header (pad port)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                headers: {\r\n                    host: 'example.com:something',\r\n                    authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n                }\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFunc, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Invalid Host header');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on credentialsFunc error', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                return callback(new Error('Unknown user'));\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Unknown user');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on credentialsFunc error (with credentials)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                return callback(new Error('Unknown user'), { some: 'value' });\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Unknown user');\r\n                expect(credentials.some).to.equal('value');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on missing credentials', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                return callback(null, null);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Unknown credentials');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on invalid credentials (id)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    user: 'steve'\r\n                };\r\n\r\n                return callback(null, credentials);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Invalid credentials');\r\n                expect(err.output.payload.message).to.equal('An internal server error occurred');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on invalid credentials (key)', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    id: '23434d3q4d5345d',\r\n                    user: 'steve'\r\n                };\r\n\r\n                return callback(null, credentials);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Invalid credentials');\r\n                expect(err.output.payload.message).to.equal('An internal server error occurred');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on unknown credentials algorithm', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcUyW6EEgUH4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'hmac-sha-0',\r\n                    user: 'steve'\r\n                };\r\n\r\n                return callback(null, credentials);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.message).to.equal('Unknown algorithm');\r\n                expect(err.output.payload.message).to.equal('An internal server error occurred');\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('errors on unknown bad mac', function (done) {\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: '/resource/4?filter=a',\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"123\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"/qwS4UjfVWMcU4jlr7T/wuKe3dKijvTvSos=\", ext=\"hello\"'\r\n            };\r\n\r\n            var credentialsFuncion = function (id, callback) {\r\n\r\n                var credentials = {\r\n                    key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                    algorithm: 'sha256',\r\n                    user: 'steve'\r\n                };\r\n\r\n                return callback(null, credentials);\r\n            };\r\n\r\n            Hawk.server.authenticate(req, credentialsFuncion, { localtimeOffsetMsec: 1353788437000 - Hawk.utils.now() }, function (err, credentials, artifacts) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.payload.message).to.equal('Bad mac');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('header()', function () {\r\n\r\n        it('generates header', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('Hawk mac=\\\"n14wVJK4cOxAytPUMc5bPezQzuJGl5n7MYXhFQgEKsE=\\\", hash=\\\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\\\", ext=\\\"response-specific\\\"');\r\n            done();\r\n        });\r\n\r\n        it('generates header (empty payload)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: '', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('Hawk mac=\\\"i8/kUBDx0QF+PpCtW860kkV/fa9dbwEoe/FpGUXowf0=\\\", hash=\\\"q/t+NNAkQZNlq/aAD6PlexImwQTxwgT2MahfTa9XRLA=\\\", ext=\\\"response-specific\\\"');\r\n            done();\r\n        });\r\n\r\n        it('generates header (pre calculated hash)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var options = { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' };\r\n            options.hash = Hawk.crypto.calculatePayloadHash(options.payload, credentials.algorithm, options.contentType);\r\n            var header = Hawk.server.header(credentials, artifacts, options);\r\n            expect(header).to.equal('Hawk mac=\\\"n14wVJK4cOxAytPUMc5bPezQzuJGl5n7MYXhFQgEKsE=\\\", hash=\\\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\\\", ext=\\\"response-specific\\\"');\r\n            done();\r\n        });\r\n\r\n        it('generates header (null ext)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: null });\r\n            expect(header).to.equal('Hawk mac=\\\"6PrybJTJs20jsgBw5eilXpcytD8kUbaIKNYXL+6g0ns=\\\", hash=\\\"f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=\\\"');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing artifacts', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, null, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid artifacts', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, 5, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on missing credentials', function (done) {\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(null, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid credentials (key)', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                algorithm: 'sha256',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n\r\n        it('errors on invalid algorithm', function (done) {\r\n\r\n            var credentials = {\r\n                id: '123456',\r\n                key: 'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn',\r\n                algorithm: 'x',\r\n                user: 'steve'\r\n            };\r\n\r\n            var artifacts = {\r\n                method: 'POST',\r\n                host: 'example.com',\r\n                port: '8080',\r\n                resource: '/resource/4?filter=a',\r\n                ts: '1398546787',\r\n                nonce: 'xUwusx',\r\n                hash: 'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk=',\r\n                ext: 'some-app-data',\r\n                mac: 'dvIvMThwi28J61Jc3P0ryAhuKpanU63GXdx6hkmQkJA=',\r\n                id: '123456'\r\n            };\r\n\r\n            var header = Hawk.server.header(credentials, artifacts, { payload: 'some reply', contentType: 'text/plain', ext: 'response-specific' });\r\n            expect(header).to.equal('');\r\n            done();\r\n        });\r\n    });\r\n\r\n    describe('authenticateBewit()', function () {\r\n\r\n        it('errors on uri too long', function (done) {\r\n\r\n            var long = '/';\r\n            for (var i = 0; i < 5000; ++i) {\r\n                long += 'x';\r\n            }\r\n\r\n            var req = {\r\n                method: 'GET',\r\n                url: long,\r\n                host: 'example.com',\r\n                port: 8080,\r\n                authorization: 'Hawk id=\"1\", ts=\"1353788437\", nonce=\"k3j4h2\", mac=\"zy79QQ5/EYFmQqutVnYb73gAc/U=\", ext=\"hello\"'\r\n            };\r\n\r\n            Hawk.server.authenticateBewit(req, credentialsFunc, {}, function (err, credentials, bewit) {\r\n\r\n                expect(err).to.exist();\r\n                expect(err.output.statusCode).to.equal(400);\r\n                expect(err.message).to.equal('Resource path exceeds max length');\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('authenticateMessage()', function () {\r\n\r\n        it('errors on invalid authorization (ts)', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                delete auth.ts;\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid authorization');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors on invalid authorization (nonce)', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                delete auth.nonce;\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid authorization');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors on invalid authorization (hash)', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                delete auth.hash;\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid authorization');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors with credentials', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, function (id, callback) {\r\n\r\n                    callback(new Error('something'), { some: 'value' });\r\n                }, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('something');\r\n                    expect(credentials2.some).to.equal('value');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('errors on nonce collision', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {\r\n                    nonceFunc: function (key, nonce, ts, nonceCallback) {\r\n\r\n                        nonceCallback(true);\r\n                    }\r\n                }, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid nonce');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should generate an authorization then successfully parse it', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    expect(credentials2.user).to.equal('steve');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on mismatching host', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example1.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Bad mac');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on stale timestamp', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, { localtimeOffsetMsec: 100000 }, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Stale timestamp');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('overrides timestampSkewSec', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1, localtimeOffsetMsec: 100000 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, { timestampSkewSec: 500 }, function (err, credentials2) {\r\n\r\n                    expect(err).to.not.exist();\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on invalid authorization', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n                delete auth.id;\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid authorization');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on bad hash', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message1', auth, credentialsFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Bad message hash');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on nonce error', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, credentialsFunc, {\r\n                    nonceFunc: function (key, nonce, ts, callback) {\r\n\r\n                        callback(new Error('kaboom'));\r\n                    }\r\n                }, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid nonce');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on credentials error', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                var errFunc = function (id, callback) {\r\n\r\n                    callback(new Error('kablooey'));\r\n                };\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, errFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('kablooey');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on missing credentials', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                var errFunc = function (id, callback) {\r\n\r\n                    callback();\r\n                };\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, errFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Unknown credentials');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on invalid credentials', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                var errFunc = function (id, callback) {\r\n\r\n                    callback(null, {});\r\n                };\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, errFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Invalid credentials');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail authorization on invalid credentials algorithm', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials1) {\r\n\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: credentials1 });\r\n                expect(auth).to.exist();\r\n\r\n                var errFunc = function (id, callback) {\r\n\r\n                    callback(null, { key: '123', algorithm: '456' });\r\n                };\r\n\r\n                Hawk.server.authenticateMessage('example.com', 8080, 'some message', auth, errFunc, {}, function (err, credentials2) {\r\n\r\n                    expect(err).to.exist();\r\n                    expect(err.message).to.equal('Unknown algorithm');\r\n                    done();\r\n                });\r\n            });\r\n        });\r\n\r\n        it('should fail on missing host', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials) {\r\n\r\n                var auth = Hawk.client.message(null, 8080, 'some message', { credentials: credentials });\r\n                expect(auth).to.not.exist();\r\n                done();\r\n            });\r\n        });\r\n\r\n        it('should fail on missing credentials', function (done) {\r\n\r\n            var auth = Hawk.client.message('example.com', 8080, 'some message', {});\r\n            expect(auth).to.not.exist();\r\n            done();\r\n        });\r\n\r\n        it('should fail on invalid algorithm', function (done) {\r\n\r\n            credentialsFunc('123456', function (err, credentials) {\r\n\r\n                var creds = Hoek.clone(credentials);\r\n                creds.algorithm = 'blah';\r\n                var auth = Hawk.client.message('example.com', 8080, 'some message', { credentials: creds });\r\n                expect(auth).to.not.exist();\r\n                done();\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('authenticatePayloadHash()', function () {\r\n\r\n        it('checks payload hash', function (done) {\r\n\r\n            expect(Hawk.server.authenticatePayloadHash('abcdefg', { hash: 'abcdefg' })).to.equal(true);\r\n            expect(Hawk.server.authenticatePayloadHash('1234567', { hash: 'abcdefg' })).to.equal(false);\r\n            done();\r\n        });\r\n    });\r\n});\r\n\r\n"]}